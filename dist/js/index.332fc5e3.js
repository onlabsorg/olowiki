(function(e){function t(t){for(var n,i,r=t[0],c=t[1],l=t[2],d=0,u=[];d<r.length;d++)i=r[d],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&u.push(s[i][0]),s[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);m&&m(t);while(u.length)u.shift()();return a.push.apply(a,l||[]),o()}function o(){for(var e,t=0;t<a.length;t++){for(var o=a[t],n=!0,i=1;i<o.length;i++){var r=o[i];0!==s[r]&&(n=!1)}n&&(a.splice(t--,1),e=c(c.s=o[0]))}return e}var n={},i={index:0},s={index:0},a=[];function r(e){return c.p+"js/"+({"swan_modules/debug":"swan_modules/debug","swan_modules/json":"swan_modules/json","swan_modules/list":"swan_modules/list","swan_modules/markdown":"swan_modules/markdown","swan_modules/numb":"swan_modules/numb","swan_modules/text":"swan_modules/text","swan_modules/time":"swan_modules/time"}[e]||e)+"."+{"chunk-0b90926a":"fdaec31f","chunk-1172ef8e":"790ce026","chunk-4c14e230":"2cb94f39","chunk-656c96f5":"9e96f2fb","chunk-e3d1e3e4":"44f9dbaf","swan_modules/debug":"c3f98aa6","swan_modules/json":"69310e46","swan_modules/list":"da90fa46","swan_modules/markdown":"bed9f4f6","swan_modules/numb":"dc47200b","swan_modules/text":"95304708","swan_modules/time":"a9536d6a","chunk-7000f2d7":"6f3e9928","chunk-dedf162c":"1083105e"}[e]+".js"}function c(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,c),o.l=!0,o.exports}c.e=function(e){var t=[],o={"chunk-0b90926a":1,"chunk-1172ef8e":1,"chunk-4c14e230":1,"chunk-656c96f5":1,"chunk-e3d1e3e4":1,"chunk-7000f2d7":1,"chunk-dedf162c":1};i[e]?t.push(i[e]):0!==i[e]&&o[e]&&t.push(i[e]=new Promise((function(t,o){for(var n="css/"+({"swan_modules/debug":"swan_modules/debug","swan_modules/json":"swan_modules/json","swan_modules/list":"swan_modules/list","swan_modules/markdown":"swan_modules/markdown","swan_modules/numb":"swan_modules/numb","swan_modules/text":"swan_modules/text","swan_modules/time":"swan_modules/time"}[e]||e)+"."+{"chunk-0b90926a":"7d62041d","chunk-1172ef8e":"50b814e9","chunk-4c14e230":"7cf74100","chunk-656c96f5":"c74dc8b9","chunk-e3d1e3e4":"e155d54b","swan_modules/debug":"31d6cfe0","swan_modules/json":"31d6cfe0","swan_modules/list":"31d6cfe0","swan_modules/markdown":"31d6cfe0","swan_modules/numb":"31d6cfe0","swan_modules/text":"31d6cfe0","swan_modules/time":"31d6cfe0","chunk-7000f2d7":"4584a489","chunk-dedf162c":"79896427"}[e]+".css",s=c.p+n,a=document.getElementsByTagName("link"),r=0;r<a.length;r++){var l=a[r],d=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(d===n||d===s))return t()}var u=document.getElementsByTagName("style");for(r=0;r<u.length;r++){l=u[r],d=l.getAttribute("data-href");if(d===n||d===s)return t()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=t,m.onerror=function(t){var n=t&&t.target&&t.target.src||s,a=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=n,delete i[e],m.parentNode.removeChild(m),o(a)},m.href=s;var h=document.getElementsByTagName("head")[0];h.appendChild(m)})).then((function(){i[e]=0})));var n=s[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise((function(t,o){n=s[e]=[t,o]}));t.push(n[2]=a);var l,d=document.createElement("script");d.charset="utf-8",d.timeout=120,c.nc&&d.setAttribute("nonce",c.nc),d.src=r(e);var u=new Error;l=function(t){d.onerror=d.onload=null,clearTimeout(m);var o=s[e];if(0!==o){if(o){var n=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+n+": "+i+")",u.name="ChunkLoadError",u.type=n,u.request=i,o[1](u)}s[e]=void 0}};var m=setTimeout((function(){l({type:"timeout",target:d})}),12e4);d.onerror=d.onload=l,document.head.appendChild(d)}return Promise.all(t)},c.m=e,c.c=n,c.d=function(e,t,o){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(c.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(o,n,function(t){return e[t]}.bind(null,n));return o},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],d=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var m=d;a.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"034f":function(e,t,o){"use strict";o("85ec")},"56d7":function(e,t,o){"use strict";o.r(t);var n=o("81ae"),i=o("2b0e"),s=o("f309");i["a"].use(s["a"]);var a=new s["a"]({}),r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-app",[o("v-app-bar",{attrs:{app:"",flat:"",color:"#F1F3F4"}},[e.navigation.show?e._e():o("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.navigation.show=!0}}},[o("v-icon",[e._v("mdi-menu")])],1),o("olo-omnibar",{model:{value:e.docId,callback:function(t){e.docId=t},expression:"docId"}}),o("v-spacer"),e.commands.show?e._e():o("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.commands.show=!0}}},[o("v-icon",[e._v("mdi-chevron-left")])],1)],1),o("v-navigation-drawer",{ref:"navigation",attrs:{app:"",floating:"","hide-overlay":"","mini-variant":e.navigation.mini&&!e.mini,width:e.navigation.width,color:"#F1F3F4"},model:{value:e.navigation.show,callback:function(t){e.$set(e.navigation,"show",t)},expression:"navigation.show"}},[o("v-toolbar",{attrs:{elevation:"0",color:"#F1F3F4"}},[o("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.mini?e.navigation.show=!1:e.navigation.mini=!e.navigation.mini}}},[o("v-icon",[e._v("mdi-menu")])],1),o("v-toolbar-title",[e._v(e._s(e.navigationTitle))])],1),!e.navigation.mini||e.mini?o("olo-tree",{attrs:{store:e.store,root:e.treeRoot,active:e.docPath},on:{"update:active":e.handleActiveTreeItemChange}}):e._e()],1),o("v-navigation-drawer",{attrs:{app:"",right:"",floating:"","mini-variant":e.commands.mini&&!e.mini,color:"#F1F3F4"},scopedSlots:e._u([{key:"append",fn:function(){return[o("v-list",[o("v-divider"),o("olo-menu-item",{attrs:{icon:"mdi-home-outline",title:"Home",kbshortcut:""},on:{click:function(t){e.docId=e.homePath}}}),o("olo-menu-item",{attrs:{icon:"mdi-help-circle-outline",title:"Help",kbshortcut:""},on:{click:function(t){e.docId=e.helpPath}}})],1)]},proxy:!0}]),model:{value:e.commands.show,callback:function(t){e.$set(e.commands,"show",t)},expression:"commands.show"}},[o("v-toolbar",{attrs:{elevation:"0",color:"#F1F3F4"}},[e.mini?o("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.commands.show=!1}}},[o("v-icon",[e._v("mdi-chevron-right")])],1):e._e(),e.mini?e._e():o("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.commands.mini=!e.commands.mini}}},[o("v-icon",[e._v(e._s(e.commands.mini&&!e.mini?"mdi-chevron-left":"mdi-chevron-right"))])],1),o("v-toolbar-title",[e._v("Document")])],1),o("v-list",["view"===e.mode?o("olo-menu-item",{attrs:{icon:"mdi-pencil",title:"Edit",kbshortcut:"CTRL-ENTER"},on:{click:function(t){e.mode="edit"}}}):e._e(),"edit"===e.mode?o("olo-menu-item",{attrs:{icon:"mdi-check",title:"Render",kbshortcut:"CTRL-ENTER"},on:{click:function(t){e.mode="view"}}}):e._e(),o("olo-menu-item",{attrs:{icon:"mdi-content-save",title:"Save",kbshortcut:"CTRL-S"},on:{click:e.save}}),o("olo-menu-item",{attrs:{icon:"mdi-content-copy",title:"Duplicate",kbshortcut:""},on:{click:function(t){return e.copyDoc(e.docPath)}}}),o("olo-menu-item",{attrs:{icon:"mdi-delete",title:"Delete",kbshortcut:""},on:{click:function(t){return e.deleteDoc(e.docPath)}}}),o("olo-menu-item",{attrs:{icon:"mdi-download",title:"Download",kbshortcut:""},on:{click:function(t){return e.download(e.docPath)}}})],1)],1),o("v-main",{staticStyle:{"background-color":"#F1F3F4"}},[o("olo-document",{ref:"document",class:e.mode,attrs:{store:e.store,path:e.docId,mode:e.mode,presets:e.context},on:{"doc-rendered":function(t){e.docData=t}}})],1),o("v-snackbar",{attrs:{timeout:e.message.timeout},scopedSlots:e._u([{key:"action",fn:function(t){var n=t.attrs;return[o("v-btn",e._b({attrs:{color:"blue",text:""},on:{click:function(t){e.message.show=!1}}},"v-btn",n,!1),[e._v(" Close ")])]}}]),model:{value:e.message.show,callback:function(t){e.$set(e.message,"show",t)},expression:"message.show"}},[e._v(" "+e._s(e.message.text)+" ")]),o("olo-input",{ref:"question"})],1)},c=[],l=o("254c"),d={name:"App",props:["appName","store","homePath","helpPath","treeRoot","context"],components:{"olo-document":()=>o.e("chunk-4c14e230").then(o.bind(null,"ac7e")),"olo-tree":()=>o.e("chunk-656c96f5").then(o.bind(null,"4a06")),"olo-menu-item":()=>o.e("chunk-0b90926a").then(o.bind(null,"90a3")),"olo-input":()=>o.e("chunk-e3d1e3e4").then(o.bind(null,"3f17")),"olo-omnibar":()=>o.e("chunk-1172ef8e").then(o.bind(null,"c2a6"))},data:()=>({docId:"",mode:"view",navigation:{show:null,mini:!0,width:256,minWidth:256,borderSize:3},commands:{show:null,mini:!0},docData:{__path__:"",__title__:"Loading ..."},activeTreeItem:[],message:{show:!1,text:"",timeout:2e3}}),computed:{docPath(){return this.docId.split("?")[0]},navigationTitle(){return this.appName||"Content"},mini(){switch(this.$vuetify.breakpoint.name){case"xs":return!0;case"sm":return!0;case"md":return!0;case"lg":return!1;case"xl":return!1;default:return!1}}},watch:{docId(){location.hash=this.store.normalizePath(this.docId)}},methods:{commit(){this.$refs.document.commit()},async save(){try{await this.$refs.document.save(),this.showMessage("Saved to "+this.docPath)}catch(e){this.showMessage("Failed to save to "+this.docPath),console.error(e)}},async copyDoc(e){const t=await this.askQuestion("Enter the path of document copy.",e);if(t)try{await this.store.copy(e,t),this.showMessage(`Copied ${e} to ${t}`)}catch(o){this.showMessage(`Failed to copy ${e} to ${t}`),console.error(o)}},async deleteDoc(e){try{e===this.docPath?await this.$refs.document.delete():await this.store.delete(e),this.showMessage("Deleted "+e)}catch(t){this.showMessage("Failed to delete "+e),console.error(t)}},async download(e){await this.store.download(e)},showMessage(e,t=2e3){this.message.text=e,this.message.timeout=t,this.message.show=!0,console.log("[olowiki message]",e)},async askQuestion(e,t=""){return await this.$refs.question.ask(e,t)},handleActiveTreeItemChange(e){"/"===e.slice(0,1)&&(this.docId=e)},handleHashChange(){const e=location.hash?location.hash.slice(1):this.homePath;this.docId=this.store.normalizePath(e)},handleMouseOverNavigationBorder(){},handleKeyboardCommand(e){const t=Object(l["detectKeyString"])(e);if("view"===this.mode)switch(t){case"Ctrl+S":e.preventDefault(),this.save();break;case"Ctrl+Return":this.mode="edit";break;default:break}else if("edit"===this.mode)switch(t){case"Ctrl+S":e.preventDefault(),this.save();break;case"Ctrl+Return":this.mode="view",this.commit();break;default:break}},initNavigation(){const e=this.$refs.navigation.$el,t=e.querySelector(".v-navigation-drawer__border");t.style.width=this.navigation.borderSize+"px";const o=this.navigation.borderSize,n=t=>{t.clientX>=this.navigation.minWidth&&(e.style.width=t.clientX+"px")};t.addEventListener("mouseover",()=>{document.body.style.cursor=this.navigation.mini?"":"ew-resize"}),t.addEventListener("mouseout",()=>{document.body.style.cursor=""}),t.addEventListener("mousedown",i=>{i.offsetX<o&&!this.navigation.mini&&(e.style.transition="initial",t.style.backgroundColor="#919191",document.addEventListener("mousemove",n,!1))},!1),document.addEventListener("mouseup",()=>{e.style.transition="",t.style.backgroundColor="",document.removeEventListener("mousemove",n,!1),this.navigation.mini||(this.navigation.width=Number(e.style.width.slice(0,-2)))},!1)}},async mounted(){document.body.addEventListener("keydown",this.handleKeyboardCommand.bind(this),!0),window.addEventListener("hashchange",this.handleHashChange.bind(this)),this.handleHashChange(),this.initNavigation()}},u=d,m=(o("034f"),o("2877")),h=o("6544"),v=o.n(h),p=o("7496"),w=o("40dc"),f=o("8336"),b=o("ce7e"),g=o("132d"),k=o("8860"),_=o("f6c45"),y=o("f774"),x=o("2db4"),P=o("2fa4"),S=o("71d9"),C=o("2a7f"),E=Object(m["a"])(u,r,c,!1,null,null,null),T=E.exports;v()(E,{VApp:p["a"],VAppBar:w["a"],VBtn:f["a"],VDivider:b["a"],VIcon:g["a"],VList:k["a"],VMain:_["a"],VNavigationDrawer:y["a"],VSnackbar:x["a"],VSpacer:P["a"],VToolbar:S["a"],VToolbarTitle:C["a"]});o("d9e2");var j=o("b69a"),D=o("21a6");const F=e=>j["normalize"]("/"+e);class L extends n["Router"]{constructor(e){super(e),this._listeners=[]}onChange(e){"function"===typeof e&&this._listeners.push(e)}_emit(e){for(let t of this._listeners)t(e)}async write(e,t){await super.write(e,t),this._emit({op:"SET",path:j["normalize"]("/"+e),value:t})}async delete(e){await super.delete(e),this._emit({op:"DEL",path:j["normalize"]("/"+e)})}}class N extends L{async exists(e){const t=await this.read(e);return""!==t}async assertNonExistance(e){if(await this.exists(e))throw new Error(`Document '${e}' already exists.`)}async createDocument(e){await this.assertNonExistance(e),await this.write(e,"")}async copy(e,t){if(e=F(e),t=F(t),await this.assertNonExistance(t),e!==t){const o=await this.read(e);await this.write(t,o)}}async download(e){const t=await this.read(e);var o=new Blob([t],{type:"text/plain;charset=utf-8"});D["saveAs"](o,j["basename"](e)+".olo")}}i["a"].config.productionTip=!1;var O=async function(e,t={}){const o={},n={};o.store=n.store=new N(t.routes||I.routes);for(let i of Object.keys(I))"routes"!==i&&(o[i]=n[i]=t[i]||I[i]);return o.vue=new i["a"]({vuetify:a,render:e=>e(T,{props:n})}).$mount(e),o};const I={appName:"olowiki",routes:{},context:{},homePath:"/",helpPath:"./wiki/help/index",treeRoot:"/"};window.olo=n,document.addEventListener("DOMContentLoaded",async()=>{n["wiki"]=await O("#app",{appName:"olowiki",routes:{"/":new n["HTTPStore"](location.origin+"/docs/"),"/.wiki/":new n["HTTPStore"](location.origin+"/.wiki/",{extension:".olo"}),"http:/":new n["HTTPStore"]("http:/"),"https:/":new n["HTTPStore"]("https:/"),"local:/":new n["BrowserStore"]("olojs_local_store"),"temp:/":new n["MemoryStore"]},context:{__olowiki__:{version:o("9224").version}},homePath:"/",helpPath:"/.wiki/help/index",treeRoot:"/"})})},"85ec":function(e,t,o){},9224:function(e){e.exports=JSON.parse('{"name":"@onlabsorg/olowiki","version":"0.17.3","description":"Wiki based on olojs documents","keywords":["wiki","swan","olojs","olojs-cli","browser","cms"],"homepage":"https://github.com/onlabsorg/olowiki#readme","bugs":{"url":"https://github.com/onlabsorg/olowiki/issues"},"author":"Marcello Del Buono","repository":{"type":"git","url":"git+https://github.com/onlabsorg/olowiki.git"},"main":"index.js","scripts":{"serve":"vue-cli-service serve","build":"vue-cli-service build","develop":"vue-cli-service build --mode develop --watch","lint":"vue-cli-service lint"},"license":"ISC","dependencies":{"@onlabsorg/olojs":"0.24.x","brace":"^0.11.1","core-js":"^3.6.5","dompurify":"^2.3.3","express":"^4.17.1","file-saver":"^2.0.5","jszip":"^3.7.1","key-string":"^0.4.0","vue":"^2.6.11","vue-async-computed":"^3.9.0","vuetify":"^2.4.0"},"devDependencies":{"@vue/cli-plugin-babel":"~4.5.0","@vue/cli-plugin-eslint":"~4.5.0","@vue/cli-service":"~4.5.0","babel-eslint":"^10.1.0","eslint":"^6.7.2","eslint-plugin-vue":"^6.2.2","sass":"~1.32.0","sass-loader":"^10.0.0","vue-cli-plugin-vuetify":"~2.4.2","vue-template-compiler":"^2.6.11","vuetify-loader":"^1.7.0"},"eslintConfig":{"root":true,"env":{"node":true},"extends":["plugin:vue/essential","eslint:recommended"],"parserOptions":{"parser":"babel-eslint"},"rules":{}},"browserslist":["> 1%","last 2 versions","not dead"],"publishConfig":{"access":"public"}}')}});
//# sourceMappingURL=index.332fc5e3.js.map